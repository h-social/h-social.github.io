<!DOCTYPE html>
<html lang="vi">

<head>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery</title>
    <script src="/script/tailwindcss.js"></script>
    <script src="/script/tailwind-usage.js"></script>
    <link rel="stylesheet" href="/style/main.css"></link>
</head>

<body class="bg-gray-50 pb-20">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">ƒêang ki·ªÉm tra ƒëƒÉng nh·∫≠p...</p>
        </div>
    </div>

    <!-- Header -->
    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="px-4 py-3 flex items-center justify-between">
            <h1 class="text-xl font-semibold text-gray-900">Gallery</h1>
            <div class="flex items-center gap-3">
                <span id="user-info" class="text-sm text-gray-600 hidden"></span>
                <button id="logout-btn" class="text-sm text-red-600 hover:text-red-700 hidden">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <!-- Filter Categories -->
        <div class="px-4 pb-3">
            <div class="flex gap-2 overflow-x-auto scrollbar-hide">
                <div class="filter-chip active" data-category="all">T·∫•t c·∫£</div>
                <div class="filter-chip" data-category="nature">Thi√™n nhi√™n</div>
                <div class="filter-chip" data-category="food">·∫®m th·ª±c</div>
                <div class="filter-chip" data-category="people">Con ng∆∞·ªùi</div>
                <div class="filter-chip" data-category="abstract">Tr·ª´u t∆∞·ª£ng</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="gallery-view" class="px-4 py-4">
        <div class="image-grid" id="image-grid">
            <!-- Sample Images -->
            <div class="image-item" data-category="nature" data-id="1">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <defs>
                        <linearGradient id="nature1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#10b981" />
                            <stop offset="100%" style="stop-color:#059669" />
                        </linearGradient>
                    </defs>
                    <rect width="400" height="400" fill="url(#nature1)" />
                    <circle cx="320" cy="80" r="40" fill="#fbbf24" />
                    <path d="M0 300 Q100 250 200 280 T400 270 L400 400 L0 400 Z" fill="#065f46" />
                    <path d="M0 320 Q150 280 300 300 L400 310 L400 400 L0 400 Z" fill="#047857" />
                </svg>
            </div>

            <div class="image-item" data-category="food" data-id="2">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <rect width="400" height="400" fill="#fef3c7" />
                    <circle cx="200" cy="200" r="120" fill="#f59e0b" />
                    <circle cx="200" cy="200" r="100" fill="#d97706" />
                    <circle cx="200" cy="200" r="80" fill="#b45309" />
                    <rect x="180" y="60" width="40" height="80" fill="#065f46" />
                </svg>
            </div>

            <div class="image-item" data-category="people" data-id="3">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <rect width="400" height="400" fill="#ddd6fe" />
                    <circle cx="200" cy="150" r="60" fill="#8b5cf6" />
                    <rect x="160" y="210" width="80" height="120" rx="10" fill="#7c3aed" />
                    <circle cx="180" cy="130" r="8" fill="#1f2937" />
                    <circle cx="220" cy="130" r="8" fill="#1f2937" />
                    <path d="M180 160 Q200 180 220 160" stroke="#1f2937" stroke-width="3" fill="none" />
                </svg>
            </div>

            <div class="image-item" data-category="abstract" data-id="4">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <rect width="400" height="400" fill="#1e293b" />
                    <circle cx="100" cy="100" r="50" fill="#3b82f6" opacity="0.7" />
                    <circle cx="300" cy="150" r="70" fill="#ef4444" opacity="0.6" />
                    <circle cx="200" cy="300" r="60" fill="#10b981" opacity="0.8" />
                    <rect x="150" y="50" width="100" height="100" fill="#f59e0b" opacity="0.5"
                        transform="rotate(45 200 100)" />
                </svg>
            </div>

            <div class="image-item" data-category="nature" data-id="5">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <rect width="400" height="400" fill="#bfdbfe" />
                    <circle cx="200" cy="100" r="50" fill="#fbbf24" />
                    <path d="M0 200 Q100 150 200 180 T400 160 L400 400 L0 400 Z" fill="#3b82f6" />
                    <path d="M50 350 Q100 320 150 340 T250 330 Q300 325 350 340" stroke="#1e40af" stroke-width="4"
                        fill="none" />
                </svg>
            </div>

            <div class="image-item" data-category="food" data-id="6">
                <svg viewBox="0 0 400 400" class="w-full h-full">
                    <rect width="400" height="400" fill="#fecaca" />
                    <circle cx="200" cy="200" r="100" fill="#dc2626" />
                    <path d="M150 180 Q200 150 250 180 Q200 220 150 180" fill="#16a34a" />
                    <ellipse cx="180" cy="190" rx="8" ry="12" fill="#fbbf24" />
                    <ellipse cx="220" cy="190" rx="8" ry="12" fill="#fbbf24" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Favorites View -->
    <div id="favorites-view" class="px-4 py-4 hidden">
        <div class="text-center py-12">
            <div class="text-6xl mb-4">‚ù§Ô∏è</div>
            <h2 class="text-xl font-semibold text-gray-900 mb-2">Ch∆∞a c√≥ ·∫£nh y√™u th√≠ch</h2>
            <p class="text-gray-600">Nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng tr√°i tim ƒë·ªÉ th√™m ·∫£nh v√†o danh s√°ch y√™u th√≠ch</p>
        </div>
        <div class="image-grid" id="favorites-grid"></div>
    </div>

    <!-- Search Overlay -->
    <div id="search-overlay" class="search-overlay">
        <div class="p-4">
            <div class="flex items-center gap-3 mb-6">
                <button id="close-search" class="text-2xl">‚Üê</button>
                <h2 class="text-xl font-semibold">T√¨m ki·∫øm</h2>
            </div>

            <div class="relative mb-6">
                <input type="text" id="search-input" placeholder="T√¨m ki·∫øm ·∫£nh..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div class="absolute right-3 top-3 text-gray-400">üîç</div>
            </div>

            <div class="text-center py-12 text-gray-500">
                <div class="text-4xl mb-4">üîç</div>
                <p>Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm ·∫£nh</p>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="modal">
        <div class="w-full h-full flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 bg-black bg-opacity-50">
                <button id="close-modal" class="text-white text-2xl">√ó</button>
                <div class="flex gap-4">
                    <button id="favorite-btn" class="heart-btn text-2xl">ü§ç</button>
                    <button id="share-btn" class="text-white text-2xl">üì§</button>
                    <button id="download-btn" class="text-white text-2xl">‚¨áÔ∏è</button>
                </div>
            </div>

            <!-- Modal Image -->
            <div class="flex-1 flex items-center justify-center p-4">
                <div id="modal-image" class="max-w-full max-h-full"></div>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 bg-black bg-opacity-50 text-white">
                <h3 id="modal-title" class="font-semibold text-lg mb-1"></h3>
                <p id="modal-description" class="text-gray-300 text-sm mb-2"></p>
                <p id="modal-date" class="text-gray-400 text-xs"></p>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="flex justify-around">
            <div class="nav-item active" data-view="gallery">
                <div class="text-2xl mb-1">üñº</div>
                <span class="text-xs">Gallery</span>
            </div>
            <div class="nav-item" data-view="favorites">
                <div class="text-2xl mb-1">‚ù§Ô∏è</div>
                <span class="text-xs">Y√™u th√≠ch</span>
            </div>
            <div class="nav-item" data-view="search">
                <div class="text-2xl mb-1">üîç</div>
                <span class="text-xs">T√¨m ki·∫øm</span>
            </div>
            <div class="nav-item" data-view="settings">
                <div class="text-2xl mb-1">‚öôÔ∏è</div>
                <span class="text-xs">C√†i ƒë·∫∑t</span>
            </div>
        </div>
    </div>
    <!-- Firebase Authentication Check -->
    <script type="module">
        import { app, auth, analytics } from "/script/function/firebase/firebase-object.js";
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";



        // UI Elements
        const loadingScreen = document.getElementById('loading-screen');
        const userInfo = document.getElementById('user-info');
        const logoutBtn = document.getElementById('logout-btn');

        // Check authentication state
        auth.onAuthStateChanged(function (user) {
            if (user) {
                // User is signed in
                console.log('User is signed in:', user.email);

                // Show user info
                userInfo.textContent = `Xin ch√†o, ${user.displayName || user.email}`;
                userInfo.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');

                // Hide loading screen
                loadingScreen.classList.add('hidden');

            } else {
                // User is not signed in, redirect to login
                console.log('User is not signed in, redirecting to login');
                window.location.href = '/views/login.html';
            }
        });

        // Logout functionality
        logoutBtn.addEventListener('click', async function () {
            try {
                await signOut(auth);
                console.log('User signed out');
                // Redirect to login page
                window.location.href = '/views/login.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });

        // Sample image data
        const imageData = {
            1: { title: "Phong c·∫£nh n√∫i non", description: "C·∫£nh ƒë·∫πp thi√™n nhi√™n h√πng vƒ©", date: "2 gi·ªù tr∆∞·ªõc", category: "nature" },
            2: { title: "B√°nh pizza ngon", description: "Pizza √ù truy·ªÅn th·ªëng", date: "5 gi·ªù tr∆∞·ªõc", category: "food" },
            3: { title: "Ch√¢n dung ngh·ªá thu·∫≠t", description: "Phong c√°ch t·ªëi gi·∫£n", date: "1 ng√†y tr∆∞·ªõc", category: "people" },
            4: { title: "Ngh·ªá thu·∫≠t tr·ª´u t∆∞·ª£ng", description: "S·∫Øc m√†u v√† h√¨nh kh·ªëi", date: "2 ng√†y tr∆∞·ªõc", category: "abstract" },
            5: { title: "Bi·ªÉn xanh", description: "S√≥ng bi·ªÉn √™m ƒë·ªÅm", date: "3 ng√†y tr∆∞·ªõc", category: "nature" },
            6: { title: "Tr√°i c√¢y t∆∞∆°i", description: "T√°o ƒë·ªè t∆∞∆°i ngon", date: "1 tu·∫ßn tr∆∞·ªõc", category: "food" }
        };



        let favorites = new Set();
        let currentView = 'gallery';

        // Navigation handling
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const view = item.dataset.view;
                switchView(view);

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
            });
        });

        function switchView(view) {
            currentView = view;

            // Hide all views
            document.getElementById('gallery-view').classList.add('hidden');
            document.getElementById('favorites-view').classList.add('hidden');
            document.getElementById('search-overlay').classList.remove('active');

            // Show selected view
            switch (view) {
                case 'gallery':
                    document.getElementById('gallery-view').classList.remove('hidden');
                    break;
                case 'favorites':
                    document.getElementById('favorites-view').classList.remove('hidden');
                    updateFavoritesView();
                    break;
                case 'search':
                    document.getElementById('search-overlay').classList.add('active');
                    break;
                case 'settings':
                    location.href = "/views/setting.html";
                    break;
            }
        }

        // Category filtering
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');

                const category = chip.dataset.category;
                filterImages(category);
            });
        });

        function filterImages(category) {
            const images = document.querySelectorAll('.image-item');
            images.forEach(img => {
                if (category === 'all' || img.dataset.category === category) {
                    img.style.display = 'block';
                } else {
                    img.style.display = 'none';
                }
            });
        }

        // Image modal handling
        document.querySelectorAll('.image-item').forEach(item => {
            item.addEventListener('click', () => {
                const imageId = item.dataset.id;
                openModal(imageId, item.querySelector('svg').outerHTML);
            });
        });

        function openModal(imageId, imageSvg) {
            const modal = document.getElementById('image-modal');
            const data = imageData[imageId];

            document.getElementById('modal-image').innerHTML = imageSvg;
            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-description').textContent = data.description;
            document.getElementById('modal-date').textContent = data.date;

            // Update favorite button
            const favoriteBtn = document.getElementById('favorite-btn');
            if (favorites.has(imageId)) {
                favoriteBtn.textContent = '‚ù§Ô∏è';
                favoriteBtn.classList.add('liked');
            } else {
                favoriteBtn.textContent = 'ü§ç';
                favoriteBtn.classList.remove('liked');
            }

            favoriteBtn.onclick = () => toggleFavorite(imageId);

            modal.classList.add('active');
        }

        function toggleFavorite(imageId) {
            const favoriteBtn = document.getElementById('favorite-btn');

            if (favorites.has(imageId)) {
                favorites.delete(imageId);
                favoriteBtn.textContent = 'ü§ç';
                favoriteBtn.classList.remove('liked');
            } else {
                favorites.add(imageId);
                favoriteBtn.textContent = '‚ù§Ô∏è';
                favoriteBtn.classList.add('liked');
            }
        }

        function updateFavoritesView() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const emptyState = document.querySelector('#favorites-view .text-center');

            if (favorites.size === 0) {
                emptyState.style.display = 'block';
                favoritesGrid.innerHTML = '';
            } else {
                emptyState.style.display = 'none';
                favoritesGrid.innerHTML = '';

                favorites.forEach(imageId => {
                    const originalItem = document.querySelector(`[data-id="${imageId}"]`);
                    const clonedItem = originalItem.cloneNode(true);
                    clonedItem.addEventListener('click', () => {
                        openModal(imageId, clonedItem.querySelector('svg').outerHTML);
                    });
                    favoritesGrid.appendChild(clonedItem);
                });
            }
        }

        // Modal controls
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('image-modal').classList.remove('active');
        });

        document.getElementById('share-btn').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: 'Chia s·∫ª ·∫£nh',
                    text: 'Xem ·∫£nh ƒë·∫πp n√†y!',
                    url: window.location.href
                });
            } else {
                alert('T√≠nh nƒÉng chia s·∫ª kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ tr√™n tr√¨nh duy·ªát n√†y');
            }
        });

        document.getElementById('download-btn').addEventListener('click', () => {
            alert('T√≠nh nƒÉng t·∫£i ·∫£nh s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong phi√™n b·∫£n ti·∫øp theo');
        });

        // Search and Settings overlays
        document.getElementById('close-search').addEventListener('click', () => {
            switchView('gallery');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-view="gallery"]').classList.add('active');
        });

        // Grid layout change
        document.querySelectorAll('input[name="grid"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const columns = e.target.value;
                const grid = document.getElementById('image-grid');
                grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            });
        });

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            // Simple search simulation - in real app would search through image metadata
            console.log('Searching for:', query);
        });

        // Close modal when clicking outside
        document.getElementById('image-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                document.getElementById('image-modal').classList.remove('active');
            }
        });
    </script>
    <script src="/script/min.js"></script>
</body>

</html>