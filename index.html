<!DOCTYPE html>
<html lang="vi">

<head>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery</title>
    <script src="/script/tailwindcss.js"></script>
    <script src="/script/tailwind-usage.js"></script>
    <link rel="stylesheet" href="/style/main.css"></link>
    <link rel="stylesheet" href="/style/tiktok-viewer.css"></link>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
</head>
<style>
    h1.text-xl.font-semibold.text-gray-900 {
        display: flex;
        align-content: center;
        align-items: center;
        gap: 10px;
    }

</style>
<body class="bg-gray-50 pb-20">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">ƒêang ki·ªÉm tra ƒëƒÉng nh·∫≠p...</p>
        </div>
    </div>

    <!-- Header -->
    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="px-4 py-3 flex items-center justify-between">
            <h1 class="text-xl font-semibold text-gray-900">
                <img src="/icons/logo.png" alt="logo" class="w-10 h-10">
                Gallery
            </h1>
            <div class="flex items-center gap-3">
                <span id="user-info" class="text-sm text-gray-600 hidden"></span>
                <button id="logout-btn" class="text-sm text-red-600 hover:text-red-700 hidden">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <!-- Filter Categories -->
        <div class="px-4 py-4" style="
            padding-bottom: 0;
        ">
            <!-- Slider main container -->
            <div class="swiper" >
                <!-- Additional required wrapper -->
                <div class="swiper-wrapper" id="category-list">
                <!-- Slides -->
                    
                </div>
                <!-- If we need pagination -->
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="gallery-view" class="px-4 py-4">
        <div class="image-grid" id="image-grid">
            <!-- Sample Images -->


        </div>
    </div>

    <!-- Favorites View -->
    <div id="favorites-view" class="px-4 py-4 hidden">
       
    </div>

    <!-- Search Overlay -->
    <div id="search-overlay" class="search-overlay">
        
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="modal">
        
    </div>

    <!-- TikTok Style Viewer Container -->
    <div id="tiktok-viewer-container" style="z-index: 1000;" class="fixed inset-0 z-50 hidden"></div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="flex justify-around">
            <div class="nav-item active" data-view="gallery">
                <div class="text-2xl mb-1">üñº</div>
                <span class="text-xs">Gallery</span>
            </div>
            <div class="nav-item" data-view="favorites">
                <div class="text-2xl mb-1">‚ù§Ô∏è</div>
                <span class="text-xs">Y√™u th√≠ch</span>
            </div>
            <div class="nav-item" data-view="search">
                <div class="text-2xl mb-1">üîç</div>
                <span class="text-xs">T√¨m ki·∫øm</span>
            </div>
            <div class="nav-item" data-view="settings">
                <div class="text-2xl mb-1">‚öôÔ∏è</div>
                <span class="text-xs">C√†i ƒë·∫∑t</span>
            </div>
        </div>
    </div>    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="/script/min.js"></script>

    <!-- Firebase Authentication Check -->
    <script type="module">
        import { Firebase } from "/script/function/Firebase.js";
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

        const firebase = new Firebase();
        const auth = firebase.getAuthApp();
        const app = firebase.getApp();

        // UI Elements
        const loadingScreen = document.getElementById('loading-screen');
        const userInfo = document.getElementById('user-info');
        const logoutBtn = document.getElementById('logout-btn');

        import { main } from "/main.js";

        const mainObj = new main();

        // Check authentication state
        auth.onAuthStateChanged(function (user) {
            if (user) {
                // User is signed in
                console.log('User is signed in:', user);

                // Show user info
                userInfo.textContent = `Xin ch√†o`;
                userInfo.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');

                // Hide loading screen
                loadingScreen.classList.add('hidden');

            } else {
                // User is not signed in, redirect to login
                console.log('User is not signed in, redirecting to login');
                window.location.href = '/views/login.html';
            }
        });

        // Logout functionality
        logoutBtn.addEventListener('click', async function () {
            try {
                await firebase.signOut();
                console.log('User signed out');
                // Redirect to login page
                window.location.href = '/views/login.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });

        // Sample image data
        const imageData = {
            1: { title: "Phong c·∫£nh n√∫i non", description: "C·∫£nh ƒë·∫πp thi√™n nhi√™n h√πng vƒ©", date: "2 gi·ªù tr∆∞·ªõc", category: "nature" },
            2: { title: "B√°nh pizza ngon", description: "Pizza √ù truy·ªÅn th·ªëng", date: "5 gi·ªù tr∆∞·ªõc", category: "food" },
            3: { title: "Ch√¢n dung ngh·ªá thu·∫≠t", description: "Phong c√°ch t·ªëi gi·∫£n", date: "1 ng√†y tr∆∞·ªõc", category: "people" },
            4: { title: "Ngh·ªá thu·∫≠t tr·ª´u t∆∞·ª£ng", description: "S·∫Øc m√†u v√† h√¨nh kh·ªëi", date: "2 ng√†y tr∆∞·ªõc", category: "abstract" },
            5: { title: "Bi·ªÉn xanh", description: "S√≥ng bi·ªÉn √™m ƒë·ªÅm", date: "3 ng√†y tr∆∞·ªõc", category: "nature" },
            6: { title: "Tr√°i c√¢y t∆∞∆°i", description: "T√°o ƒë·ªè t∆∞∆°i ngon", date: "1 tu·∫ßn tr∆∞·ªõc", category: "food" }
        };



        let favorites = new Set();
        let currentView = 'gallery';

        // Navigation handling
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const view = item.dataset.view;
                switchView(view);

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
            });
        });

        function switchView(view) {
            currentView = view;

            // Hide all views
            document.getElementById('gallery-view').classList.add('hidden');
            document.getElementById('favorites-view').classList.add('hidden');
            document.getElementById('search-overlay').classList.remove('active');

            // Show selected view
            switch (view) {
                case 'gallery':
                    document.getElementById('gallery-view').classList.remove('hidden');
                    break;
                case 'favorites':
                    document.getElementById('favorites-view').classList.remove('hidden');
                    updateFavoritesView();
                    break;
                case 'search':
                    document.getElementById('search-overlay').classList.add('active');
                    break;
                case 'settings':
                    location.href = "/views/setting.html";
                    break;
            }
        }

        // Category filtering
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');

                const category = chip.dataset.category;
                filterImages(category);
            });
        });

        function filterImages(category) {
            const images = document.querySelectorAll('.image-item');
            images.forEach(img => {
                if (category === 'all' || img.dataset.category === category) {
                    img.style.display = 'block';
                } else {
                    img.style.display = 'none';
                }
            });
        }

        function toggleFavorite(imageId) {
            const favoriteBtn = document.getElementById('favorite-btn');

            if (favorites.has(imageId)) {
                favorites.delete(imageId);
                favoriteBtn.textContent = 'ü§ç';
                favoriteBtn.classList.remove('liked');
            } else {
                favorites.add(imageId);
                favoriteBtn.textContent = '‚ù§Ô∏è';
                favoriteBtn.classList.add('liked');
            }
        }

        function updateFavoritesView() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const emptyState = document.querySelector('#favorites-view .text-center');

            if (favorites.size === 0) {
                emptyState.style.display = 'block';
                favoritesGrid.innerHTML = '';
            } else {
                emptyState.style.display = 'none';
                favoritesGrid.innerHTML = '';

                favorites.forEach(imageId => {
                    const originalItem = document.querySelector(`[data-id="${imageId}"]`);
                    const clonedItem = originalItem.cloneNode(true);
                    clonedItem.addEventListener('click', () => {
                        openModal(imageId, clonedItem.querySelector('svg').outerHTML);
                    });
                    favoritesGrid.appendChild(clonedItem);
                });
            }
        }

        

        // Search and Settings overlays
        document.getElementById('close-search').addEventListener('click', () => {
            switchView('gallery');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-view="gallery"]').classList.add('active');
        });

        // Grid layout change
        document.querySelectorAll('input[name="grid"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const columns = e.target.value;
                const grid = document.getElementById('image-grid');
                grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            });
        });

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            // Simple search simulation - in real app would search through image metadata
            console.log('Searching for:', query);
        });

        // Close modal when clicking outside
        document.getElementById('image-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                document.getElementById('image-modal').classList.remove('active');
            }
        });

        import { GitMain } from "/script/function/github/git-usage.js";
        const gitMain = await GitMain.create(app);
        gitMain.render();

        $('body').on('click', '.more-btn', function(){
            gitMain.loadMoreImages()
        })
        $('body').on('click', '.swiper-slide', function(){
            const category = $(this).attr('data-category')
            $('.swiper-slide.selected').removeClass('selected');
            $(this).addClass('selected');
            gitMain.loadCategory(category)
        })

        // Listen to TikTok viewer events
        document.addEventListener('favoriteToggled', (e) => {
            console.log('Favorite toggled in TikTok viewer:', e.detail);
            // Here you can sync with your main favorites system
        });

        document.addEventListener('viewerClosed', (e) => {
            console.log('TikTok viewer closed at index:', e.detail.currentIndex);
            const container = document.getElementById('tiktok-viewer-container');
            container.classList.add('hidden');
            document.body.classList.remove('viewer-open');
        });
         

        $('body').on('click', '.image-item', function(){
            const imageUrl = $(this).attr('data-url')
            gitMain.modelObj.focus(imageUrl);
            gitMain.modelObj.show();
        })

    </script>
</body>

</html>